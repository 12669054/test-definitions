metadata:
  name: jtreg
  format: "Lava-Test-Shell Test Definition 1.0"
  description: "Regression tests for the OpenJDK platform"
  version: 1.0

install:
  git-repos:
    - git://git.linaro.org/leg/openjdk/jtreg-bin.git
    - git://git.linaro.org/leg/openjdk/openjdk8-aarch64-prebuilt-tests.git
    - git://git.linaro.org/qa/test-definitions.git

run:
  steps:
    - 'set -x'
    - 'export TESTRUN_ID'
    - 'PATH=/lava/tests/$TESTRUN_ID/jtreg-bin/jtreg/linux/bin:$PATH'
    - 'TEST_DIR=/lava/tests/$TESTRUN_ID/openjdk8-aarch64-prebuilt-tests'
    - 'CLASSES_DIR=$TEST_DIR/JTwork/classes'
    - 'for i in $CLASSES_DIR/*; do find $i -print | xargs touch -d tomorrow; done'
    - 'df -h'
    - 'pushd $PWD'
    - 'cd $TEST_DIR; tar xf openjdk8-aarch64-snapshot.tar'
    - 'popd'
    - 'df -h'
    - 'export JT_HOME=/lava/tests/$TESTRUN_ID/jtreg-bin/jtreg'
    - 'export JT_JAVA=/usr/lib/jvm/java-8-openjdk/bin/java'
    - 'export PRODUCT_HOME=/usr/lib/jvm/java-8-openjdk'
    - 'export JDK_TEST_DIR=$TEST_DIR/openjdk8-aarch64-snapshot/jdk/test'
    - 'export JDK_TEST_VMOPTS=-vmoption:-Xint'
    - 'export JTREG=$JT_HOME/linux/bin/jtreg-lava'
    - 'export JTREG_LAVA_PREBUILT_CLASSES_DIR=$CLASSES_DIR'
    - 'cd test-definitions/openembedded/scripts'
    - './jtreg-jdk-test jdk_beans1'
    - './jtreg-jdk-test jdk_io'
    - './jtreg-jdk-test jdk_lang'
    - './jtreg-jdk-test jdk_math'
    - './jtreg-jdk-test jdk_net'
    - './jtreg-jdk-test jdk_other'
    - './jtreg-jdk-test jdk_security1'
    - './jtreg-jdk-test jdk_text'
    - './jtreg-jdk-test jdk_time'
    - './jtreg-jdk-test jdk_util'
