metadata:
  name: jtreg
  format: "Lava-Test-Shell Test Definition 1.0"
  description: "Regression tests for the OpenJDK platform"
  version: 1.0

install:
  git-repos:
    - git://git.linaro.org/leg/openjdk/jtreg-bin.git
    - git://git.linaro.org/leg/openjdk/openjdk8-aarch64-prebuilt-tests.git
    - git://git.linaro.org/qa/test-definitions.git

run:
  steps:
    - 'set -x'
    - 'export TESTRUN_ID'
    - 'PATH=/lava/tests/$TESTRUN_ID/jtreg-bin/jtreg/linux/bin:$PATH'
    - 'TEST_DIR=/lava/tests/$TESTRUN_ID/openjdk8-aarch64-prebuilt-tests'
    - 'CLASSES_DIR=$TEST_DIR/JTwork/classes'
    - 'for i in $CLASSES_DIR/*; do find $i -print | xargs touch -d tomorrow; done'
    - 'df -h'
    - 'pushd $PWD'
    - 'cd $TEST_DIR; tar xf openjdk8-aarch64-snapshot.tar'
    - 'popd'
    - 'df -h'
    - 'export JT_HOME=/lava/tests/$TESTRUN_ID/jtreg-bin/jtreg'
    - 'export JT_JAVA=/usr/lib/jvm/java-8-openjdk/bin/java'
    - 'export PRODUCT_HOME=/usr/lib/jvm/java-8-openjdk'
    - 'export JDK_TEST_DIR=$TEST_DIR/openjdk8-aarch64-snapshot/jdk/test'
    - 'export HOTSPOT_TEST_DIR=$TEST_DIR/openjdk8-aarch64-snapshot/hotspot/test'
    - 'export JTREG=$JT_HOME/linux/bin/jtreg-lava'
    - 'export JTREG_LAVA_PREBUILT_CLASSES_DIR=$CLASSES_DIR'
    - 'cd test-definitions/openembedded/scripts'
    - './jtreg-test $JDK_TEST_DIR jdk_beans1'
    - './jtreg-test $JDK_TEST_DIR jdk_io'
    - './jtreg-test $JDK_TEST_DIR jdk_lang'
    - './jtreg-test $JDK_TEST_DIR jdk_math'
    - './jtreg-test $JDK_TEST_DIR jdk_net'
    - './jtreg-test $JDK_TEST_DIR jdk_other'
    - './jtreg-test $JDK_TEST_DIR jdk_security1'
    - './jtreg-test $JDK_TEST_DIR jdk_text'
    - './jtreg-test $JDK_TEST_DIR jdk_time'
    - './jtreg-test $JDK_TEST_DIR jdk_util'
    - 'TESTDIRS=sanity ./jtreg-test $HOTSPOT_TEST_DIR sanity'
    - 'TESTDIRS=compiler ./jtreg-test $HOTSPOT_TEST_DIR compiler'
    - 'TESTDIRS=gc ./jtreg-test $HOTSPOT_TEST_DIR gc'
    - 'TESTDIRS=runtime ./jtreg-test $HOTSPOT_TEST_DIR runtime'
    - 'TESTDIRS=serviceability ./jtreg-test $HOTSPOT_TEST_DIR serviceability'
    - 'TESTDIRS=testlibrary ./jtreg-test $HOTSPOT_TEST_DIR testlibrary'
