metadata:
  name: jtreg
  format: "Lava-Test-Shell Test Definition 1.0"
  description: "Regression tests for the OpenJDK platform"
  version: 1.0

install:
  git-repos:
    - git://git.linaro.org/leg/openjdk/jtreg-bin.git
    - git://git.linaro.org/leg/openjdk/openjdk8-aarch64-test-archive.git
    - git://git.linaro.org/qa/test-definitions.git

run:
  steps:
    - 'export TESTRUN_ID'
    - 'PATH=/lava/tests/$TESTRUN_ID/jtreg-bin/jtreg/linux/bin:$PATH'
    - 'TEST_DIR=/lava/tests/$TESTRUN_ID/openjdk8-aarch64-test-archive'
    - 'CLASSES_DIR=$TEST_DIR/openjdk8-aarch64-port-snapshot/JTwork/classes'
    - 'for i in $TEST_DIR/openjdk8-aarch64-port-snapshot/jdk/*; do find $i -print | xargs touch -d now; done'
    - 'for i in $TEST_DIR/openjdk8-aarch64-port-snapshot/hotspot/*; do find $i -print | xargs touch -d now; done'
    - 'for i in $CLASSES_DIR/*; do find $i -print | xargs touch -d tomorrow; done'
    - 'export JT_HOME=/lava/tests/$TESTRUN_ID/jtreg-bin/jtreg'
    - 'export JT_JAVA=/usr/lib/jvm/java-8-openjdk/bin/java'
    - 'export PRODUCT_HOME=/usr/lib/jvm/java-8-openjdk'
    - 'export JDK_TEST_DIR=$TEST_DIR/openjdk8-aarch64-port-snapshot/jdk/test'
    - 'export HOTSPOT_TEST_DIR=$TEST_DIR/openjdk8-aarch64-port-snapshot/hotspot/test'
    - 'export JTREG=$JT_HOME/linux/bin/jtreg-lava'
    - 'export JTREG_LAVA_PREBUILT_CLASSES_DIR=$CLASSES_DIR'
    - 'cd test-definitions/openembedded/scripts'
    - 'TESTDIRS=sanity ./jtreg-test $HOTSPOT_TEST_DIR sanity'
